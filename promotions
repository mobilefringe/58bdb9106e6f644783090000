<div class="promotions_header">
    <div class="row">
        <div class="col-md-12">
            <h3 class="store_list_header">Promotions</h3>
        </div>   
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="site_searcher_div" >
                <label class="top_form_control no_margin">
                    <i class="custom_i fa fa-search"></i>
                    <input type="text" placeholder="Search" id="site_search" />
                    <i id="close_search" class="fa fa-times-circle"></i>
                </label>
                <div class="site_search_results" id="search_results_stores"></div>
                <div class="site_search_results" id="search_results_events"></div>
                <div class="site_search_results" id="search_results_promotions"></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="promotions_header_container">
                <select id="category_select">
                    <script id="category_select_template" type="x-tmpl-mustache/text">
                        <option value="">{{name}}</option>
                    </script>
                </select>
            </div>
        </div>
        <div class="col-md-4">
            <a href="/stores">
                <div class="promotions_header_container">View Directory</div>    
            </a>
        </div>
    </div>
</div>


<div class="fluid_row mobile_padding">
    <div class="row">
        <!--<div class="col-md-12">-->
        <!--    <h3 class="store_list_header">Promotions</h3>-->
        <!--</div>-->
        <div id="promos_container">
            <script id="promos_template" type="x-tmpl-mustache/text">
                <div class="col-md-4 margin_50">
                    <div class="promo_container" value="{{categories}}">
                        <div class="promo_img_container">
                            <img src="{{image_url}}" alt="Promotion" class="promo_img" />
                        </div>
                        <div class="details">
                            <h3 class="details_header">{{name}}</h3>
                            <h3 class="details_store_name">{{store_name}}</h3>
                            <h3 class="jobs_publish_date"><i class="fa fa-calendar"></i> &nbsp;{{dates}}</h3>    
                        </div>
                        <a href="/promotions/{{slug}}" class="read_more_btn">Read More</a>
                    </div>
                </div>
            </script>
        </div>
        <div class="col-md-12">
            <h3 id="no_promos" class="hidden_now">There are currently no promotions available, please check back again later.</h3>
        </div>
    </div>
</div>
<div class="margin_40"></div>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var category_list = getStoreCategories();
            renderGeneral("#category_select", "#category_select_template", category_list);
            $("#category_select").prepend("<option selected>Sort By Category</option>");
            
            var promotions = getPromotionsList().sortBy(function(o){ return o.end_date });
            console.log(promotions)
            var published_promos = [];
            $.each(promotions, function(key, val){
                today = moment();
                webDate = moment(val.show_on_web_date)
                if (today.tz(getPropertyTimeZone()) >= webDate.tz(getPropertyTimeZone())) {
                    published_promos.push(val);
                } 
            });
            if(published_promos.length > 0){
                renderPromotions("#promos_container","#promos_template", published_promos);
            }
            else{
                $('#no_promos').show()
            }
            show_content();
            $('#top_nav_promotions').addClass('active_yellow')
        }
        loadMallDataCached(renderAll); 
    });
</script>