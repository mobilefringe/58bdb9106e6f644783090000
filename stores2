<div class="promotions_header">
    <div class="site_container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="store_list_header">Stores</h3>
            </div>   
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="promotions_header_container store_search" >
                    <label class="">
                        <input type="text" placeholder="Find Your Store" id="store_search" />
                        <img src="//codecloud.cdn.speedyrails.net/sites/58bdb9106e6f644783090000/image/png/1488985579000/search-512.png" class="pull-right" alt="">
                        
                        <i id="close_search" class="fa fa-times-circle"></i>
                    </label>
                    <div class="site_search_results" id="search_results_stores"></div>
                    <div class="site_search_results" id="search_results_events"></div>
                    <div class="site_search_results" id="search_results_promotions"></div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="promotions_header_container">
                    <select id="category_select">
                        <script id="category_select_template" type="x-tmpl-mustache/text">
                            <option class="show_cat_stores" data-id="{{id}}" value="{{name}}">{{name}}</option>
                        </script>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <a href="/map">
                    <div class="promotions_header_container directory_btn">View Map</div>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="alpha_list">
                    <a href="#7">#</a>
                    <a href="#A">A</a>
                    <a href="#B">B</a>
                    <a href="#C">C</a>
                    <a href="#D">D</a>
                    <a href="#E">E</a>
                    <a href="#F">F</a>
                    <a href="#G">G</a>
                    <a href="#H">H</a>
                    <a href="#I">I</a>
                    <a href="#J">J</a>
                    <a href="#K">K</a>
                    <a href="#L">L</a>
                    <a href="#M">M</a>
                    <a href="#N">N</a>
                    <a href="#O">O</a>
                    <a href="#P">P</a>
                    <a href="#Q">Q</a>
                    <a href="#R">R</a>
                    <a href="#S">S</a>
                    <a href="#T">T</a>
                    <a href="#U">U</a>
                    <a href="#V">V</a>
                    <a href="#W">W</a>
                    <a href="#X">X</a>
                    <a href="#Y">Y</a>
                    <a href="#Z">Z</a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="site_container">
    <div class="row">
        <div class="col-md-12">
            <div class="row_fluid">
                <div id="store_list_container">
                    <script id="store_list_template" type="x-tmpl-mustache/text">
                        <div style="{{show}}" class="store_initial" id="{{initial}}">{{initial}}</div>
                        <div class="store_logo_container cats_row" data-cat="{{cat_list}}">
                            <a href="/stores/{{slug}}">
                                <img style="{{initial_img}}" src="{{store_front_url_abs}}"/>
                                <div class="store_coming_soon" style="{{new_store}}">
                                    <span class="new_store">Coming soon</span>
                                </div>
                                <div class="store_list_promos">
                                    <span class="promo_exist" style="{{job_exist}}"><img src="//codecloud.cdn.speedyrails.net/sites/58bdb9106e6f644783090000/image/png/1489000358000/jobs.png" class="" alt=""> {{job_list}}</span>
                                    <span class="promo_exist" style="{{promotion_exist}}"><img src="//codecloud.cdn.speedyrails.net/sites/58bdb9106e6f644783090000/image/png/1489000371000/promotions.png" class="" alt=""> {{promotion_list}}</span>
                                </div>
                            </a>
                        </div>
                    </script>
                </div>
            </div>
        </div>
 
    </div>
</div>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            var categories = getStoreCategories();
            

            renderGeneral("#category_select", "#category_select_template", categories);
            $("#category_select").prepend("<option selected>Sort By Category</option>");
            // 
            
            
            var stores = getStoresList();
            console.log(stores);
            renderStoreList('#store_list_container','#store_list_template', stores, "stores");
            renderGeneral('#category_container', '#category_template', categories);
            renderGeneral('#category_container_phone', '#category_template_phone', categories);
            $('#category_container_phone').prepend('<li href="#" class="show_all_stores">All</li>');
            show_content();
            
            show_cat_stores();
            $('#top_nav_stores').addClass('active_yellow')
        }
        loadMallDataCached(renderAll); 
    });
    
    function show_cat_stores(){
    $("#category_select").on('change', function(e) {    
        var cat_id = $(this).attr('data-id');
        console.log(cat_id)
        $('.active_cat').removeClass('active_cat');
        $(this).addClass('active_cat');
        var rows = $('.cats_row');
        rows.hide();
        $('.store_initial').hide();
        $('#cat_name').text($(this).text());
        $('#cat_name').css('display', 'block');
        $.each(rows, function(i, val){
            var cat_array = val.getAttribute('data-cat').split(',');
            if ($.inArray(cat_id, cat_array) >= 0){
                $(val).show();
            }
        });
        $('html, body').animate({scrollTop : 0},800);
        e.preventDefault();
    });
    $('.show_all_stores').click(function(e){
        $('.active_cat').removeClass('active_cat');
        $(this).addClass('active_cat');
        var rows = $('.cats_row');
        rows.show();
        $.each($('.store_initial'), function(i, val){
           if ($(val).text().length > 0){
               $(val).show();
           } 
        });
        $('#cat_name').hide();
        e.preventDefault();
    });
    
}
</script>